// ==UserScript==
// @name         Crunchy/MAL linker
// @namespace    https://github.com/roddolf/scripts
// @version      1.4.0
// @description  Add links into Crunchyroll for MAL anime library.
// @author       Rodolfo Aguirre
// @include      /^https?:\/\/www.crunchyroll.com\/([a-z-]+/)?[a-zA-Z-\d]+$/
// @include      /^https?:\/\/beta.crunchyroll.com\/([a-z-]+\/)?series\/[a-zA-Z-\d]+\/[a-zA-Z-\d]+$/
// @updateURL    https://raw.githubusercontent.com/roddolf/crunchyroll-mal-linker/master/script.meta.js
// @downloadURL  https://raw.githubusercontent.com/roddolf/crunchyroll-mal-linker/master/dist/script.user.js
// ==/UserScript==
!function(){"use strict";var e=window&&window.__awaiter||function(e,A,t,n){return new(t||(t=Promise))((function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var A;e.done?i(e.value):(A=e.value,A instanceof t?A:new t((function(e){e(A)}))).then(a,s)}u((n=n.apply(e,A||[])).next())}))};const A="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABSlBMVEUAAAAuUaIuUaIuUaIuUaIuUaIuUaIuUaIuUaIuUaIuUaIuUaIuUaIuUaIuUaIuUaI1VqU8Xag5W6cyVKQ1V6U3WaaQo87////6+/1YdLV5j8NrhL2InMrH0eby9Pm5xOC1wt7g5fE4WaZKaK709fqEmcjw8/gwU6OvvNvS2euquNleebh0jMGcrNOks9fo7PW3w9+hsdWdrtRferjx8/l9k8X9/f5ge7j+/v/v8fhzisEwUqN2jcKjs9bL0+jz9fpPbLHO1un4+vz3+PuKncva4O+ot9iBlseNoMyCl8e9yOE0VqXX3u20wd6sutpMaq/e5PC9yOJ1jML4+fxUcLPN1enFz+XBy+OvvdyisdXQ2Or19/vj6PNrg706W6f7/P2FmcnK0+fV3Oy4xN/h5vIvUqKuu9uaq9J+lMZLaa/8/P7d4vBbd7apt9n+PssoAAAAD3RSTlMBFYfT+dGDU/EX81X79c+4RnuEAAAAAWJLR0QXC9aYjwAAAAd0SU1FB+QKHwgGD8s9R/MAAAGYSURBVEjH7dZXV8IwFADgsIfjMsS4UGSIAxeIC/fGvReKWvf6/6/eJrVQT1uaB1883ock9+R+tE1PSQghxGZ3OKFmOF1uG2Hh8dau5uH1sHqr5XKgsFn+fXYNH3GL1APYiUsMOIiF9dGsFRGrB/gHvwUCwWAwpKQ4DIYrsyFMmwAi2EUqoJlS2tLKsjYc0nbFdkQ75bQLIIZdTAtodxyTRLICUqwaoyetC2gvQLiPfoN0P1VjQB/QDAxSFQyx0fDIaDabzRmAsfy4CiYmsZ+aLsxEo9FZMABqIJjDbn6BTy3qgiVeu8xBQr7ACpiB1TUG1jlIyd1GsVjcNAZb29juAAe71XdoAGAvSffjCjiwAuDw6BgUcGIJANZXgdOi+TMoKQdn2J6D+SppwAW2lz9A6UqOa32Qkd9MWQtY3JT1QbyE3a0OuGO3lJck6V4BOJRywF7EwyOfegJ4lpR4MfpEX9/o+4fQN/2ZDYAQKJj9CYjFnwCCW5ZfdFN0iW+7PtGNXfjoQEid3/ITe/hxBo8/9bWrGxrZ8ecLzYqyUsKHVC0AAAAldEVYdGRhdGU6Y3JlYXRlADIwMjAtMTAtMzFUMDg6MDY6MTMrMDA6MDA+Vi6IAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIwLTEwLTMxVDA4OjA2OjEzKzAwOjAwTwuWNAAAAABJRU5ErkJggg==",t=A=>e(void 0,void 0,void 0,(function*(){const e=`https://api.jikan.moe/v3/search/anime?q=${encodeURI(A)}&limit=1`,{results:[t]}=yield n("GET",e);if(t)return t.url})),n=(A,t)=>e(void 0,void 0,void 0,(function*(){const e=new Request(t,{method:A}),n=yield fetch(e);return 200!==n.status?Promise.reject(n):n.json()}));var i;location.hostname.startsWith("beta.")?(i=".erc-series-hero > .body .title",e(void 0,void 0,void 0,(function*(){return document.querySelector(i)||new Promise((e=>{new MutationObserver(((A,t)=>{const n=document.querySelector(i);n&&(t.disconnect(),e(n))})).observe(document.documentElement,{childList:!0,subtree:!0})}))}))).then((n=>e(void 0,void 0,void 0,(function*(){var e;const i=n.textContent;if(!i)return;const o=yield t(i);if(!o)return;const a=document.createElement("a");a.href=o,a.style.display="inline-block",a.style.marginBottom="10px";const s=document.createElement("img");s.src=A,s.style.width="25px",a.appendChild(s),null===(e=n.parentElement)||void 0===e||e.insertBefore(a,n.nextElementSibling)})))):$((()=>e(void 0,void 0,void 0,(function*(){if(!$("#source_showview").length)return;const e=$("h1.ellipsis"),n=$("h1.ellipsis span").text(),i=yield t(n);i&&e.append(`<a href="${i}" style="vertical-align: middle;"><img src="${A}" style='width: 17px; border: 0'></a>`)}))))}();
